# This CD workflow releases packages to OSSRH Nexus repository and to Maven Central
# It only runs on MASTER branch AFTER Build and Test Workflow is completed AND if commit is tagged (which is done when merging previous commits)

name: Release on OSSRH, Maven Central

on:
  workflow_run:
    workflows: [Build and test]
    types:
      - completed
    branches: [master, main]

jobs:
  publish_release:
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/master' && contains(github.ref, 'refs/tags/')

    steps: 
    - name: Download artifact
      uses: dawidd6/action-download-artifact@v2
      with:
        github_token: ${{secrets.GITHUB_TOKEN}}
        workflow: Release-Build-Test.yml
        workflow_conclusion: success

    - name: release_ossrh_central
      run: |
        mvn release:perform
          